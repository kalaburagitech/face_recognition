<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•ä¸Šä¼ æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .upload-zone { 
            border: 2px dashed #ccc; 
            padding: 40px; 
            text-align: center; 
            cursor: pointer;
            margin: 20px 0;
        }
        .upload-zone:hover { border-color: #007bff; }
        button { padding: 10px 20px; margin: 10px; }
        #output { margin: 20px 0; padding: 15px; background: #f8f9fa; }
        img { max-width: 300px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ç®€å•ä¸Šä¼ æµ‹è¯•</h1>
    
    <div class="upload-zone" id="uploadZone">
        <p>ç‚¹å‡»è¿™é‡Œé€‰æ‹©å›¾ç‰‡</p>
        <input type="file" id="imageFile" accept="image/*" style="display: none;">
    </div>
    
    <div>
        <button onclick="testUpload()" id="testBtn">æµ‹è¯•ä¸Šä¼ è¯†åˆ«</button>
        <button onclick="clearTest()">æ¸…é™¤</button>
    </div>
    
    <div id="output"></div>

    <script>
        let selectedFile = null;
        
        // åˆå§‹åŒ–ä¸Šä¼ åŒºåŸŸ
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('imageFile');
        
        uploadZone.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        function handleFile(file) {
            selectedFile = file;
            const output = document.getElementById('output');
            
            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            output.innerHTML = `
                <h3>é€‰ä¸­çš„æ–‡ä»¶:</h3>
                <p><strong>æ–‡ä»¶å:</strong> ${file.name}</p>
                <p><strong>æ–‡ä»¶å¤§å°:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                <p><strong>æ–‡ä»¶ç±»å‹:</strong> ${file.type}</p>
            `;
            
            // æ˜¾ç¤ºé¢„è§ˆ
            const reader = new FileReader();
            reader.onload = (e) => {
                output.innerHTML += `<br><img src="${e.target.result}" alt="é¢„è§ˆ">`;
            };
            reader.readAsDataURL(file);
            
            // å¯ç”¨æµ‹è¯•æŒ‰é’®
            document.getElementById('testBtn').disabled = false;
        }
        
        async function testUpload() {
            const output = document.getElementById('output');
            
            if (!selectedFile) {
                output.innerHTML += '<p style="color: red;">âŒ è¯·å…ˆé€‰æ‹©æ–‡ä»¶</p>';
                return;
            }
            
            output.innerHTML += '<p>â³ æ­£åœ¨ä¸Šä¼ è¯†åˆ«...</p>';
            
            try {
                const formData = new FormData();
                formData.append('file', selectedFile);
                
                const response = await fetch('/api/recognize', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    output.innerHTML += `
                        <div style="color: green;">
                            <h3>âœ… è¯†åˆ«æˆåŠŸ!</h3>
                            <p><strong>æ£€æµ‹åˆ°äººè„¸:</strong> ${result.total_faces} ä¸ª</p>
                            <p><strong>è¯†åˆ«åŒ¹é…:</strong> ${result.matches.length} ä¸ª</p>
                            ${result.matches.map(m => `<p>ğŸ‘¤ ${m.name} (åŒ¹é…åº¦: ${m.match_score}%)</p>`).join('')}
                        </div>
                    `;
                } else {
                    const errorText = await response.text();
                    output.innerHTML += `<p style="color: red;">âŒ è¯†åˆ«å¤±è´¥: ${response.status}<br>${errorText}</p>`;
                }
            } catch (error) {
                output.innerHTML += `<p style="color: red;">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</p>`;
            }
        }
        
        function clearTest() {
            selectedFile = null;
            document.getElementById('output').innerHTML = '';
            document.getElementById('imageFile').value = '';
            document.getElementById('testBtn').disabled = true;
        }
        
        // åˆå§‹çŠ¶æ€
        document.getElementById('testBtn').disabled = true;
    </script>
</body>
</html>
