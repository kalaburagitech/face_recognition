<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººè„¸è¯†åˆ«ç³»ç»Ÿ - æ™ºèƒ½äººè„¸è¯†åˆ«ç®¡ç†å¹³å°</title>
    <meta name="description" content="åŸºäºæ·±åº¦å­¦ä¹ çš„äººè„¸è¯†åˆ«ç³»ç»Ÿï¼Œæ”¯æŒäººå‘˜æ³¨å†Œã€è¯†åˆ«ã€ç®¡ç†å’Œç»Ÿè®¡åˆ†æ">
    <meta name="keywords" content="äººè„¸è¯†åˆ«,æ·±åº¦å­¦ä¹ ,äººå‘˜ç®¡ç†,InsightFace">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text y='14' font-size='14'>ğŸ‘ï¸</text></svg>">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link href="assets/css/main.css" rel="stylesheet">
    
    <!-- äººå‘˜ç®¡ç†å¢å¼ºæ ·å¼ -->
    <style>
        /* äººè„¸ç…§ç‰‡ç”»å»Šæ ·å¼ */
        .face-thumbnail {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .face-thumbnail:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .face-image-container {
            position: relative;
            height: 80px;
            overflow: hidden;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .face-image-container:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .face-image-container:active {
            transform: scale(0.98);
        }
        
        .face-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .face-placeholder {
            height: 80px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .face-actions {
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .face-thumbnail:hover .face-actions {
            opacity: 1;
        }
        
        .btn-action {
            width: 28px;
            height: 28px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2px;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .face-info {
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .face-thumbnail:hover .face-info {
            opacity: 1;
        }
        
        /* ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .upload-area {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .upload-area:hover {
            border-color: var(--bs-primary) !important;
            background-color: rgba(var(--bs-primary-rgb), 0.05);
        }
        
        /* ä¿¡æ¯å¡ç‰‡æ ·å¼å¢å¼º */
        .info-card {
            background: rgba(var(--bs-primary-rgb), 0.05);
            border-radius: 8px;
            padding: 12px;
            border-left: 3px solid var(--bs-primary);
        }
        
        .info-label {
            font-size: 0.75rem;
            color: var(--bs-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .info-value {
            font-weight: 500;
            color: var(--bs-dark);
        }
        
        /* æ¨¡æ€æ¡†å¢å¼º */
        .bg-gradient-primary {
            background: linear-gradient(135deg, var(--bs-primary) 0%, #0056b3 100%);
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 576px) {
            .face-actions {
                opacity: 1; /* åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå§‹ç»ˆæ˜¾ç¤ºæ“ä½œæŒ‰é’® */
            }
            
            .btn-action {
                width: 24px;
                height: 24px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-camera-reels me-2"></i>
                äººè„¸è¯†åˆ«ç³»ç»Ÿ
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto nav-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="recognition-tab" data-bs-toggle="tab" data-bs-target="#recognition" type="button" role="tab" aria-controls="recognition" aria-selected="true">
                            <i class="bi bi-search me-1"></i>äººè„¸è¯†åˆ«
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="enrollment-tab" data-bs-toggle="tab" data-bs-target="#enrollment" type="button" role="tab" aria-controls="enrollment" aria-selected="false">
                            <i class="bi bi-person-plus me-1"></i>äººå‘˜æ³¨å†Œ
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="management-tab" data-bs-toggle="tab" data-bs-target="#management" type="button" role="tab" aria-controls="management" aria-selected="false">
                            <i class="bi bi-people me-1"></i>äººå‘˜ç®¡ç†
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab" aria-controls="analytics" aria-selected="false">
                            <i class="bi bi-bar-chart me-1"></i>ç»Ÿè®¡åˆ†æ
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="container my-4">
        <div class="tab-content" id="mainTabContent">
            <!-- äººè„¸è¯†åˆ«æ ‡ç­¾é¡µ -->
            <div class="tab-pane fade show active" id="recognition" role="tabpanel" aria-labelledby="recognition-tab">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-camera-fill me-2"></i>
                                    ä¸Šä¼ ç…§ç‰‡è¿›è¡Œè¯†åˆ«
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="upload-zone" id="uploadZone">
                                    <div class="upload-content">
                                        <i class="bi bi-cloud-upload"></i>
                                        <h6>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ ç…§ç‰‡</h6>
                                        <p class="mb-0">æ”¯æŒ JPEGã€PNGã€WebPã€BMPã€TIFF æ ¼å¼</p>
                                        <small class="text-muted">æœ€å¤§æ–‡ä»¶å¤§å°: 10MB | æ¨èåˆ†è¾¨ç‡: 640x480ä»¥ä¸Š</small>
                                    </div>
                                    <input type="file" id="imageFile" accept="image/*" style="display: none;">
                                </div>
                                
                                <div id="imagePreview" class="mt-3" style="display: none;">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-primary fw-semibold">å›¾ç‰‡é¢„è§ˆ</span>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearImagePreview()">
                                            <i class="bi bi-x me-1"></i>é‡æ–°é€‰æ‹©
                                        </button>
                                    </div>
                                    <img id="previewImg" class="img-fluid rounded shadow" alt="é¢„è§ˆå›¾ç‰‡" style="max-height: 300px;">
                                    <div id="imageInfo" class="mt-2 small text-muted"></div>
                                </div>

                                <div class="d-grid gap-2 mt-3">
                                    <button id="recognizeBtn" class="btn btn-primary btn-lg" disabled>
                                        <i class="bi bi-search me-2"></i>
                                        å¼€å§‹è¯†åˆ«
                                    </button>
                                    <div class="d-flex gap-2">
                                        <button id="clearBtn" class="btn btn-outline-secondary flex-fill" onclick="clearRecognition()" style="display: none;">
                                            <i class="bi bi-arrow-clockwise me-1"></i>
                                            é‡ç½®
                                        </button>
                                        <button id="downloadBtn" class="btn btn-outline-primary flex-fill" onclick="downloadResult()" style="display: none;">
                                            <i class="bi bi-download me-1"></i>
                                            ä¸‹è½½ç»“æœ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-clipboard-data me-2"></i>
                                    è¯†åˆ«ç»“æœ
                                </h5>
                            </div>
                            <div class="card-body position-relative">
                                <div id="recognitionResults">
                                    <div class="empty-state">
                                        <i class="bi bi-search"></i>
                                        <h6>ç­‰å¾…è¯†åˆ«</h6>
                                        <p class="mb-0">è¯·ä¸Šä¼ ç…§ç‰‡å¼€å§‹è¯†åˆ«</p>
                                    </div>
                                </div>
                                <div id="recognitionLoading" class="loading-overlay" style="display: none;">
                                    <div class="text-center">
                                        <div class="loading-spinner mb-3"></div>
                                        <div class="fw-semibold text-primary">æ­£åœ¨è¯†åˆ«ä¸­...</div>
                                        <div class="small text-muted">è¯·ç¨å€™ï¼Œæ­£åœ¨åˆ†æäººè„¸ç‰¹å¾</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- äººå‘˜æ³¨å†Œæ ‡ç­¾é¡µ -->
            <div class="tab-pane fade" id="enrollment" role="tabpanel" aria-labelledby="enrollment-tab">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-person-plus me-2"></i>
                                    æ³¨å†Œæ–°äººå‘˜
                                </h5>
                            </div>
                            <div class="card-body">
                                <form id="enrollmentForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="personName" class="form-label">å§“å *</label>
                                            <input type="text" class="form-control" id="personName" placeholder="è¯·è¾“å…¥å§“å" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="personDescription" class="form-label">æè¿°</label>
                                            <input type="text" class="form-control" id="personDescription" placeholder="å¯é€‰æè¿°ä¿¡æ¯">
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">ç…§ç‰‡ä¸Šä¼  *</label>
                                        <div class="upload-zone" id="enrollmentUpload">
                                            <div class="upload-content">
                                                <i class="bi bi-images"></i>
                                                <h6>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ ç…§ç‰‡</h6>
                                                <p class="mb-0">æ”¯æŒ JPEGã€PNGã€WebP æ ¼å¼</p>
                                                <small class="text-muted">å¯ä¸Šä¼ å¤šå¼ ç…§ç‰‡ï¼Œæé«˜è¯†åˆ«å‡†ç¡®ç‡</small>
                                            </div>
                                            <input type="file" id="enrollmentFile" accept="image/*" multiple style="display: none;">
                                        </div>
                                    </div>

                                    <div id="enrollmentPreview" class="d-none">
                                        <label class="form-label">é¢„è§ˆç…§ç‰‡</label>
                                        <div id="enrollmentImages" class="row"></div>
                                    </div>

                                    <div class="d-flex gap-2">
                                        <button type="button" id="enrollBtn" class="btn btn-success" disabled>
                                            <i class="bi bi-person-plus me-1"></i>
                                            æ³¨å†Œäººå‘˜
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" onclick="clearEnrollment()">
                                            <i class="bi bi-arrow-clockwise me-1"></i>
                                            é‡ç½®
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-check-circle me-2"></i>
                                    æ³¨å†Œç»“æœ
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="enrollmentResults">
                                    <div class="empty-state">
                                        <i class="bi bi-person-plus"></i>
                                        <h6>ç­‰å¾…æ³¨å†Œä¿¡æ¯</h6>
                                        <p class="mb-0">è¯·ä¸Šä¼ ç…§ç‰‡å¹¶å¡«å†™ä¿¡æ¯</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- äººå‘˜ç®¡ç†æ ‡ç­¾é¡µ -->
            <div class="tab-pane fade" id="management" role="tabpanel" aria-labelledby="management-tab">
                <!-- é¡¶éƒ¨æ“ä½œæ  -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-body py-3">
                                <div class="d-flex align-items-center">
                                    <h5 class="card-title mb-0 me-3">
                                        <i class="bi bi-people-fill me-2 text-primary"></i>
                                        äººå‘˜ç®¡ç†
                                    </h5>
                                    <span class="badge bg-primary person-count">åŠ è½½ä¸­...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body py-3">
                                <div class="d-flex gap-2">
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="bi bi-search"></i>
                                        </span>
                                        <input type="text" class="form-control" id="searchPerson" placeholder="æœç´¢äººå‘˜...">
                                    </div>
                                    <button class="btn btn-outline-primary" onclick="refreshPersonList()" title="åˆ·æ–°">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="showSortOptions()" title="æ’åº">
                                        <i class="bi bi-sort-down"></i>
                                    </button>
                                    <button class="btn btn-primary" onclick="showBulkOperations()" title="æ‰¹é‡æ“ä½œ">
                                        <i class="bi bi-list-check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ‰¹é‡æ“ä½œé¢æ¿ -->
                <div class="bulk-operations-panel" style="display: none;">
                    <div class="card border-warning mb-3">
                        <div class="card-header bg-warning text-dark">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="bi bi-check2-square me-2"></i>
                                    <strong>æ‰¹é‡æ“ä½œ</strong>
                                    <small id="selectedCount" class="ms-2">(å·²é€‰æ‹© 0 é¡¹)</small>
                                </div>
                                <button class="btn btn-sm btn-outline-dark" onclick="hideBulkOperations()">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body py-2">
                            <div class="d-flex flex-wrap gap-2 align-items-center">
                                <button class="btn btn-sm btn-outline-primary" onclick="selectAllPersons()">
                                    <i class="bi bi-check-all me-1"></i>å…¨é€‰
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="clearAllSelections()">
                                    <i class="bi bi-square me-1"></i>æ¸…ç©ºé€‰æ‹©
                                </button>
                                <div class="vr"></div>
                                <button class="btn btn-sm btn-outline-success" onclick="exportSelectedPersons()" id="bulkExportBtn" disabled>
                                    <i class="bi bi-download me-1"></i>å¯¼å‡ºé€‰ä¸­
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteSelectedPersons()" id="bulkDeleteBtn" disabled>
                                    <i class="bi bi-trash me-1"></i>æ‰¹é‡åˆ é™¤
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- äººå‘˜åˆ—è¡¨ -->
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-grid-3x3-gap me-2"></i>
                                    äººå‘˜åˆ—è¡¨
                                </h6>
                                <div class="btn-group btn-group-sm" role="group">
                                    <input type="radio" class="btn-check" name="viewMode" id="cardView" checked>
                                    <label class="btn btn-outline-secondary" for="cardView" title="å¡ç‰‡è§†å›¾">
                                        <i class="bi bi-grid"></i>
                                    </label>
                                    <input type="radio" class="btn-check" name="viewMode" id="listView">
                                    <label class="btn btn-outline-secondary" for="listView" title="åˆ—è¡¨è§†å›¾">
                                        <i class="bi bi-list"></i>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body p-3">
                                <div id="personsList">
                                    <div class="d-flex justify-content-center p-5">
                                        <div class="text-center">
                                            <div class="spinner-border text-primary mb-3" role="status">
                                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                            </div>
                                            <p class="text-muted">æ­£åœ¨åŠ è½½äººå‘˜æ•°æ®...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¾§è¾¹æ ä¿¡æ¯é¢æ¿ -->
                    <div class="col-lg-4">
                        <!-- å¿«é€Ÿç»Ÿè®¡ -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-bar-chart me-2"></i>
                                    å¿«é€Ÿç»Ÿè®¡
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-6">
                                        <div class="border-end">
                                            <h4 class="text-primary mb-1" id="totalPersonsCount">0</h4>
                                            <small class="text-muted">æ€»äººå‘˜</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <h4 class="text-success mb-1" id="totalFacesCount">0</h4>
                                        <small class="text-muted">æ€»ç…§ç‰‡</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- æœ€è¿‘æ“ä½œ -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-clock-history me-2"></i>
                                    æœ€è¿‘æ“ä½œ
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="recentOperations">
                                    <small class="text-muted">æš‚æ— æ“ä½œè®°å½•</small>
                                </div>
                            </div>
                        </div>

                        <!-- æ‰¹é‡æ“ä½œé¢æ¿ -->
                        <div class="card" id="bulkOperationsPanel" style="display: none;">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-list-check me-2"></i>
                                    æ‰¹é‡æ“ä½œ
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-primary btn-sm" onclick="selectAllPersons()">
                                        <i class="bi bi-check-all me-1"></i>å…¨é€‰
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="clearSelection()">
                                        <i class="bi bi-x-square me-1"></i>æ¸…é™¤é€‰æ‹©
                                    </button>
                                    <hr>
                                    <button class="btn btn-outline-danger btn-sm" onclick="bulkDeletePersons()" disabled id="bulkDeleteBtn">
                                        <i class="bi bi-trash me-1"></i>æ‰¹é‡åˆ é™¤
                                    </button>
                                    <button class="btn btn-outline-info btn-sm" onclick="exportSelectedPersons()" disabled id="bulkExportBtn">
                                        <i class="bi bi-download me-1"></i>å¯¼å‡ºæ•°æ®
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡åˆ†ææ ‡ç­¾é¡µ -->
            <div class="tab-pane fade" id="analytics" role="tabpanel" aria-labelledby="analytics-tab">
                <!-- é¡¶éƒ¨æ¦‚è§ˆå¡ç‰‡ - ç®€åŒ–å¸ƒå±€ -->
                <div class="row mb-4">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="analytics-card">
                            <div class="analytics-icon bg-primary">
                                <i class="bi bi-people-fill"></i>
                            </div>
                            <div class="analytics-info">
                                <h3 id="statTotalPersons">0</h3>
                                <p>æ€»äººå‘˜æ•°</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="analytics-card">
                            <div class="analytics-icon bg-success">
                                <i class="bi bi-camera-fill"></i>
                            </div>
                            <div class="analytics-info">
                                <h3 id="statTotalEncodings">0</h3>
                                <p>æ€»ç…§ç‰‡æ•°</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="analytics-card">
                            <div class="analytics-icon bg-warning">
                                <i class="bi bi-bullseye"></i>
                            </div>
                            <div class="analytics-info">
                                <h3 id="statThreshold">0.35</h3>
                                <p>è¯†åˆ«é˜ˆå€¼</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="analytics-card">
                            <div class="analytics-icon bg-info">
                                <i class="bi bi-cpu"></i>
                            </div>
                            <div class="analytics-info">
                                <h3 class="text-success">æ­£å¸¸</h3>
                                <p>ç³»ç»ŸçŠ¶æ€</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
                <div class="row">
                    <!-- å·¦ä¾§ï¼šå®æ—¶ç»Ÿè®¡é¢æ¿ -->
                    <div class="col-lg-8">
                        <div class="analytics-panel">
                            <div class="analytics-header">
                                <h5><i class="bi bi-bar-chart-line me-2"></i>ç³»ç»Ÿç»Ÿè®¡</h5>
                                <button class="btn btn-outline-primary btn-sm" onclick="refreshAllData()">
                                    <i class="bi bi-arrow-clockwise me-1"></i>åˆ·æ–°
                                </button>
                            </div>
                            <div class="analytics-content">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="stat-item">
                                            <strong>æ³¨å†Œäººå‘˜æ€»æ•°</strong>
                                            <span id="detailTotalPersons">0</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="stat-item">
                                            <strong>äººè„¸ç…§ç‰‡æ€»æ•°</strong>
                                            <span id="detailTotalEncodings">0</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="stat-item">
                                            <strong>å¹³å‡æ¯äººç…§ç‰‡</strong>
                                            <span id="avgPhotosPerPerson">0.0 å¼ </span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="stat-item">
                                            <strong>å½“å‰é˜ˆå€¼</strong>
                                            <span id="currentThreshold">0.35</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="quick-actions mt-4">
                                    <button class="btn btn-outline-success btn-sm" onclick="exportStatistics()">
                                        <i class="bi bi-download me-1"></i>å¯¼å‡ºç»Ÿè®¡
                                    </button>
                                    <button class="btn btn-outline-info btn-sm" onclick="downloadSystemReport()">
                                        <i class="bi bi-file-text me-1"></i>ç³»ç»ŸæŠ¥å‘Š
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šé…ç½®é¢æ¿ -->
                    <div class="col-lg-4">
                        <div class="analytics-panel">
                            <div class="analytics-header">
                                <h5><i class="bi bi-gear-fill me-2"></i>ç³»ç»Ÿé…ç½®</h5>
                            </div>
                            <div class="analytics-content">
                                <form id="configForm">
                                    <div class="config-item">
                                        <label for="recognitionThreshold" class="form-label">äººè„¸è¯†åˆ«é˜ˆå€¼</label>
                                        <div class="input-group">
                                            <input type="range" class="form-range" id="recognitionThresholdRange" 
                                                   min="0.1" max="0.9" step="0.01" value="0.2">
                                            <input type="number" class="form-control" id="recognitionThreshold" 
                                                   min="0.1" max="0.9" step="0.01" value="0.2">
                                        </div>
                                        <small class="text-muted">å½“å‰: <span id="recognitionThresholdDisplay">0.2</span></small>
                                        <div class="form-text text-muted mt-1">åŒ¹é…å·²çŸ¥äººè„¸æ—¶çš„ç›¸ä¼¼åº¦é˜ˆå€¼ã€‚å€¼è¶Šå¤§è¦æ±‚è¶Šä¸¥æ ¼ï¼Œåªæœ‰æ›´ç›¸ä¼¼çš„äººè„¸æ‰ä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€äºº</div>
                                    </div>

                                    <div class="config-item">
                                        <label for="detectionThreshold" class="form-label">äººè„¸æ£€æµ‹é˜ˆå€¼</label>
                                        <div class="input-group">
                                            <input type="range" class="form-range" id="detectionThresholdRange" 
                                                   min="0.1" max="0.9" step="0.01" value="0.5">
                                            <input type="number" class="form-control" id="detectionThreshold" 
                                                   min="0.1" max="0.9" step="0.01" value="0.5">
                                        </div>
                                        <small class="text-muted">å½“å‰: <span id="detectionThresholdDisplay">0.5</span></small>
                                        <div class="form-text text-muted mt-1">æ£€æµ‹å›¾åƒä¸­æ˜¯å¦åŒ…å«äººè„¸çš„ç½®ä¿¡åº¦é˜ˆå€¼ã€‚å€¼è¶Šå¤§è¿‡æ»¤è¶Šä¸¥æ ¼ï¼Œåªæœ‰é«˜ç½®ä¿¡åº¦çš„æ£€æµ‹æ‰ä¼šè¢«ä¿ç•™</div>
                                    </div>

                                    <div class="config-item">
                                        <label for="duplicateThreshold" class="form-label">é‡å¤å…¥åº“é˜ˆå€¼</label>
                                        <div class="input-group">
                                            <input type="range" class="form-range" id="duplicateThresholdRange" 
                                                   min="0.8" max="0.99" step="0.01" value="0.95">
                                            <input type="number" class="form-control" id="duplicateThreshold" 
                                                   min="0.8" max="0.99" step="0.01" value="0.95">
                                        </div>
                                        <small class="text-muted">å½“å‰: <span id="duplicateThresholdDisplay">0.95</span></small>
                                        <div class="form-text text-muted mt-1">é˜²æ­¢åŒä¸€äººé‡å¤æ³¨å†Œçš„ç›¸ä¼¼åº¦é˜ˆå€¼ã€‚å€¼è¶Šå¤§é˜²é‡å¤è¶Šä¸¥æ ¼ï¼Œéœ€è¦æ›´é«˜çš„ç›¸ä¼¼åº¦æ‰ä¼šè¢«æ‹’ç»</div>
                                    </div>

                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <button type="button" class="btn btn-outline-secondary me-md-2" onclick="analytics.loadConfiguration()">
                                            <i class="bi bi-arrow-clockwise me-1"></i>é‡ç½®
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="analytics.updateConfiguration()">
                                            <i class="bi bi-check-lg me-1"></i>ä¿å­˜é…ç½®
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- ç³»ç»Ÿä¿¡æ¯ -->
                        <div class="analytics-panel mt-3">
                            <div class="analytics-header">
                                <h5><i class="bi bi-info-circle-fill me-2"></i>ç³»ç»Ÿä¿¡æ¯</h5>
                            </div>
                            <div class="analytics-content">
                                <div class="system-info">
                                    <div class="info-item">
                                        <strong>å½“å‰æ¨¡å‹:</strong>
                                        <span id="currentModel">buffalo_l</span>
                                    </div>
                                    <div class="info-item">
                                        <strong>æ‰§è¡Œæä¾›è€…:</strong>
                                        <span id="currentProvider">CPU</span>
                                    </div>
                                    <div class="info-item">
                                        <strong>æœ€å¤§æ–‡ä»¶:</strong>
                                        <span>10MB</span>
                                    </div>
                                    <div class="info-item">
                                        <strong>æ”¯æŒæ ¼å¼:</strong>
                                        <span>JPEG, PNG, WebP</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å¿«é€Ÿæ“ä½œ -->
                        <div class="analytics-panel mt-3">
                            <div class="analytics-header">
                                <h5><i class="bi bi-lightning-fill me-2"></i>å¿«é€Ÿæ“ä½œ</h5>
                            </div>
                            <div class="analytics-content">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-warning btn-sm" onclick="clearCache()">
                                        <i class="bi bi-trash3 me-1"></i>æ¸…ç†ç¼“å­˜
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="showApiDocs()">
                                        <i class="bi bi-book me-1"></i>APIæ–‡æ¡£
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æœ€åæ›´æ–°æ—¶é—´ -->
                <div class="text-center mt-4">
                    <small class="text-muted">
                        <i class="bi bi-clock me-1"></i>
                        æœ€åæ›´æ–°: <span id="lastUpdateTime">åŠ è½½ä¸­...</span>
                    </small>
                </div>
            </div>
        </div>
    </main>

    <!-- äººå‘˜è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal fade" id="personDetailModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">äººå‘˜è¯¦æƒ…</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- åŠ¨æ€å¡«å……å†…å®¹ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                    <button type="button" class="btn btn-danger">
                        <i class="bi bi-trash me-1"></i>
                        åˆ é™¤äººå‘˜
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast å®¹å™¨ - ç§»åŠ¨åˆ°å³ä¸‹è§’ -->
    <div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 9999;"></div>

    <!-- JavaScript ä¾èµ– -->
    <!-- Bootstrap 5.3 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- å·¥å…·æ¨¡å— -->
    <script src="assets/js/utils.js"></script>
    
    <!-- åŠŸèƒ½æ¨¡å— -->
    <script src="assets/js/recognition.js"></script>
    <script src="assets/js/enrollment.js"></script>
    <script src="assets/js/management.js"></script>
    <script src="assets/js/analytics.js"></script>

    <!-- ä¸»åº”ç”¨åˆå§‹åŒ– -->
    <script>
        // åº”ç”¨ä¸»ç±»
        class FaceRecognitionApp {
            constructor() {
                this.modules = {};
                this.init();
            }

            async init() {
                try {
                    console.log('åˆå§‹åŒ–Tabå¯¼èˆª...');
                    this.initializeTabs();
                    
                    // åˆå§‹åŒ–å„ä¸ªæ¨¡å—
                    this.modules.recognition = new FaceRecognition();
                    this.modules.enrollment = new PersonEnrollment();
                    this.modules.management = new PersonManagement();
                    this.modules.analytics = new Analytics();

                    console.log('äººè„¸è¯†åˆ«ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                    // å®‰å…¨åœ°æ˜¾ç¤ºToastï¼ˆå¦‚æœå¤±è´¥ä¸ä¼šé˜»æ­¢åˆå§‹åŒ–ï¼‰
                    try {
                        ToastManager.show('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success');
                    } catch (e) {
                        console.log('Toastæ˜¾ç¤ºå¤±è´¥ï¼Œä½†ç³»ç»Ÿæ­£å¸¸åˆå§‹åŒ–');
                    }

                } catch (error) {
                    console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
                    // å³ä½¿Toastå¤±è´¥ä¹Ÿè¦å°è¯•æ˜¾ç¤ºé”™è¯¯
                    try {
                        ToastManager.show('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥', 'error');
                    } catch (e) {
                        console.error('Toastç³»ç»Ÿä¹Ÿå¤±è´¥äº†');
                    }
                }
            }

            initializeTabs() {
                // ç¡®ä¿Bootstrapå·²åŠ è½½
                if (typeof bootstrap === 'undefined') {
                    console.error('BootstrapæœªåŠ è½½ï¼');
                    return;
                }

                // æ‰‹åŠ¨åˆå§‹åŒ–æ‰€æœ‰Tab
                const tabElements = document.querySelectorAll('[data-bs-toggle="tab"]');
                console.log(`æ‰¾åˆ°${tabElements.length}ä¸ªtabå…ƒç´ `);
                
                tabElements.forEach((tabEl, index) => {
                    try {
                        // åˆ›å»ºBootstrap Tabå®ä¾‹
                        const tab = new bootstrap.Tab(tabEl);
                        console.log(`Tab ${index + 1} åˆå§‹åŒ–æˆåŠŸ:`, tabEl.getAttribute('data-bs-target'));
                        
                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
                        tabEl.addEventListener('click', (e) => {
                            e.preventDefault();
                            tab.show();
                            console.log('Tab clicked:', tabEl.getAttribute('data-bs-target'));
                        });
                        
                    } catch (error) {
                        console.error(`Tab ${index + 1} åˆå§‹åŒ–å¤±è´¥:`, error);
                    }
                });

                // ç›‘å¬Tabåˆ‡æ¢äº‹ä»¶
                document.addEventListener('shown.bs.tab', (event) => {
                    const targetId = event.target.getAttribute('data-bs-target');
                    console.log('Tab åˆ‡æ¢åˆ°:', targetId);
                    this.onTabShown(targetId.substring(1));
                });
            }

            onTabShown(tabId) {
                console.log('å¤„ç†Tabåˆ‡æ¢:', tabId);
                // æ ‡ç­¾é¡µåˆ‡æ¢æ—¶çš„å¤„ç†é€»è¾‘
                switch (tabId) {
                    case 'management':
                        // åˆ·æ–°äººå‘˜åˆ—è¡¨
                        if (this.modules.management) {
                            this.modules.management.loadPersons();
                        }
                        break;
                    case 'analytics':
                        // åˆ·æ–°ç»Ÿè®¡æ•°æ®
                        if (this.modules.analytics) {
                            this.modules.analytics.loadData();
                        }
                        break;
                }
            }
        }

        // å…¨å±€å‡½æ•°æ˜ å°„ï¼ˆå…¼å®¹åŸæœ‰çš„onclickäº‹ä»¶ï¼‰
        function clearEnrollment() {
            if (app.modules.enrollment) {
                app.modules.enrollment.clearEnrollment();
            }
        }

        function refreshPersonList() {
            if (app.modules.management) {
                app.modules.management.loadPersons();
                app.modules.management.addRecentOperation('åˆ·æ–°æ•°æ®', 'é‡æ–°åŠ è½½äººå‘˜åˆ—è¡¨æ•°æ®');
            }
        }

        function showSortOptions() {
            if (app.modules.management) {
                app.modules.management.showSortOptions();
            }
        }

        function refreshStats() {
            if (app.modules.analytics) {
                app.modules.analytics.loadData();
            }
        }

        function saveConfig() {
            if (app.modules.analytics) {
                app.modules.analytics.saveConfiguration();
            }
        }

        // ç»Ÿè®¡åˆ†æé¡µé¢ä¸“ç”¨å‡½æ•°
        function refreshAllData() {
            if (app.modules.analytics) {
                app.modules.analytics.loadData();
            }
        }

        function saveConfiguration() {
            if (app.modules.analytics) {
                app.modules.analytics.saveConfiguration();
            }
        }

        function exportStatistics() {
            if (app.modules.analytics) {
                app.modules.analytics.exportStats();
            } else {
                alert('ç»Ÿè®¡æ¨¡å—æœªåŠ è½½ï¼Œæ— æ³•å¯¼å‡ºæ•°æ®');
            }
        }

        function downloadSystemReport() {
            if (app.modules.analytics) {
                app.modules.analytics.downloadSystemReport();
            } else {
                alert('ç»Ÿè®¡æ¨¡å—æœªåŠ è½½ï¼Œæ— æ³•ä¸‹è½½æŠ¥å‘Š');
            }
        }

        function clearCache() {
            if (app.modules.analytics) {
                app.modules.analytics.clearCache();
            } else {
                if (confirm('ç¡®å®šè¦æ¸…ç†ç¼“å­˜å—ï¼Ÿ')) {
                    localStorage.clear();
                    sessionStorage.clear();
                    alert('ç¼“å­˜å·²æ¸…ç†');
                    location.reload();
                }
            }
        }

        function showApiDocs() {
            if (app.modules.analytics) {
                app.modules.analytics.showApiDocs();
            } else {
                alert('API æ–‡æ¡£\n\nä¸»è¦æ¥å£ï¼š\n- GET /api/statistics - è·å–ç»Ÿè®¡æ•°æ®\n- POST /api/config - ä¿å­˜é…ç½®\n- POST /api/recognize - äººè„¸è¯†åˆ«\n- GET /api/persons - è·å–äººå‘˜åˆ—è¡¨');
            }
        }

        // äººå‘˜ç®¡ç†ç›¸å…³å‡½æ•°
        function showBulkOperations() {
            // åˆ‡æ¢æ‰¹é‡æ“ä½œé¢æ¿æ˜¾ç¤º
            const panel = document.querySelector('.bulk-operations-panel');
            if (panel) {
                const isVisible = panel.style.display !== 'none';
                panel.style.display = isVisible ? 'none' : 'block';
                
                // å¦‚æœæ˜¾ç¤ºé¢æ¿ï¼Œç¡®ä¿æœ‰é€‰æ‹©åŠŸèƒ½
                if (!isVisible && app.modules.management) {
                    app.modules.management.enableBulkSelection();
                }
            }
        }

        function hideBulkOperations() {
            const panel = document.querySelector('.bulk-operations-panel');
            if (panel) {
                panel.style.display = 'none';
            }
            if (app.modules.management) {
                app.modules.management.disableBulkSelection();
            }
        }

        function selectAllPersons() {
            if (app.modules.management) {
                app.modules.management.selectAllPersons();
            }
        }

        function clearAllSelections() {
            if (app.modules.management) {
                app.modules.management.clearAllSelections();
            }
        }

        function exportSelectedPersons() {
            if (app.modules.management) {
                app.modules.management.exportSelectedPersons();
            }
        }

        function deleteSelectedPersons() {
            if (app.modules.management) {
                app.modules.management.bulkDeletePersons();
            }
        }

        function selectAllPersons() {
            if (app.modules.management) {
                app.modules.management.selectAllPersons();
            } else {
                // ç®€å•çš„å…¨é€‰å®ç°
                const checkboxes = document.querySelectorAll('input[type="checkbox"][data-person-id]');
                checkboxes.forEach(cb => cb.checked = true);
                updateBulkButtons();
            }
        }

        function clearSelection() {
            if (app.modules.management) {
                app.modules.management.clearSelection();
            } else {
                // ç®€å•çš„æ¸…é™¤é€‰æ‹©å®ç°
                const checkboxes = document.querySelectorAll('input[type="checkbox"][data-person-id]');
                checkboxes.forEach(cb => cb.checked = false);
                updateBulkButtons();
            }
        }

        function bulkDeletePersons() {
            const selected = document.querySelectorAll('input[type="checkbox"][data-person-id]:checked');
            if (selected.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„äººå‘˜');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selected.length} ä¸ªäººå‘˜å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) {
                if (app.modules.management) {
                    app.modules.management.bulkDeletePersons();
                } else {
                    alert('æ‰¹é‡åˆ é™¤åŠŸèƒ½å¼€å‘ä¸­...');
                }
            }
        }

        function exportSelectedPersons() {
            const selected = document.querySelectorAll('input[type="checkbox"][data-person-id]:checked');
            if (selected.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦å¯¼å‡ºçš„äººå‘˜');
                return;
            }
            
            if (app.modules.management) {
                app.modules.management.exportSelectedPersons();
            } else {
                alert('æ‰¹é‡å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
            }
        }

        function updateBulkButtons() {
            const selected = document.querySelectorAll('input[type="checkbox"][data-person-id]:checked');
            const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
            const bulkExportBtn = document.getElementById('bulkExportBtn');
            
            if (bulkDeleteBtn) {
                bulkDeleteBtn.disabled = selected.length === 0;
            }
            if (bulkExportBtn) {
                bulkExportBtn.disabled = selected.length === 0;
            }
        }

        // æ–°å¢çš„å…¨å±€å‡½æ•°
        function clearRecognition() {
            if (app.modules.recognition) {
                app.modules.recognition.clearRecognition();
            }
        }

        function clearImagePreview() {
            if (app.modules.recognition) {
                app.modules.recognition.clearRecognition();
            }
        }

        function downloadResult() {
            // TODO: å®ç°ä¸‹è½½è¯†åˆ«ç»“æœåŠŸèƒ½
            if (window.ToastManager) {
                ToastManager.show('ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            } else {
                alert('ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­...');
            }
        }

        function downloadVisualization(url) {
            const a = document.createElement('a');
            a.href = url;
            a.download = `face_recognition_result_${new Date().getTime()}.jpg`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            if (window.ToastManager) {
                ToastManager.show('å¯è§†åŒ–ç»“æœå·²ä¸‹è½½', 'success');
            } else {
                alert('å¯è§†åŒ–ç»“æœå·²ä¸‹è½½');
            }
        }

        function showImageModal(url) {
            // åˆ›å»ºç®€å•çš„æ¨¡æ€æ¡†æ˜¾ç¤ºå¤§å›¾
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">è¯†åˆ«ç»“æœè¯¦å›¾</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="${url}" class="img-fluid" alt="è¯†åˆ«ç»“æœè¯¦å›¾">
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            if (window.bootstrap) {
                const bootstrapModal = new bootstrap.Modal(modal);
                bootstrapModal.show();
                
                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            } else {
                // ç®€å•çš„å›¾ç‰‡æŸ¥çœ‹å™¨
                window.open(url, '_blank');
                document.body.removeChild(modal);
            }
        }

        function showEnrollmentModal() {
            // åˆ‡æ¢åˆ°æ³¨å†Œæ ‡ç­¾é¡µ
            const enrollmentTab = document.getElementById('enrollment-tab');
            if (enrollmentTab) {
                if (window.bootstrap) {
                    const tab = new bootstrap.Tab(enrollmentTab);
                    tab.show();
                } else {
                    // ç®€å•çš„æ ‡ç­¾åˆ‡æ¢
                    enrollmentTab.click();
                }
                
                if (window.ToastManager) {
                    ToastManager.show('å·²åˆ‡æ¢åˆ°äººå‘˜æ³¨å†Œé¡µé¢', 'info');
                }
            }
        }

        // å¯åŠ¨åº”ç”¨
        let app;
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMåŠ è½½å®Œæˆï¼Œå¯åŠ¨åº”ç”¨...');
            
            // å…ˆå¼ºåˆ¶åˆå§‹åŒ–Tabå¯¼èˆªï¼ˆä¸ä¾èµ–äºå…¶ä»–æ¨¡å—ï¼‰
            initializeTabsDirectly();
            
            // ç„¶ååˆå§‹åŒ–ä¸»åº”ç”¨
            try {
                app = new FaceRecognitionApp();
                
                // è®¾ç½®å…¨å±€å¼•ç”¨ä»¥ä¾¿è°ƒè¯•
                window.app = app;
                window.personManagement = app.modules.management;
                window.analytics = app.modules.analytics;
            } catch (error) {
                console.error('ä¸»åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œä½†Tabå¯¼èˆªä»ç„¶å¯ç”¨:', error);
            }
        });

        // ç›´æ¥åˆå§‹åŒ–Tabå¯¼èˆªçš„å‡½æ•°
        function initializeTabsDirectly() {
            console.log('ç›´æ¥åˆå§‹åŒ–Tabå¯¼èˆª...');
            
            // ç­‰å¾…BootstrapåŠ è½½
            const waitForBootstrap = setInterval(() => {
                if (typeof bootstrap !== 'undefined') {
                    clearInterval(waitForBootstrap);
                    
                    const tabElements = document.querySelectorAll('[data-bs-toggle="tab"]');
                    console.log(`æ‰¾åˆ°${tabElements.length}ä¸ªtabå…ƒç´ `);
                    
                    tabElements.forEach((tabEl, index) => {
                        try {
                            // åˆ›å»ºBootstrap Tabå®ä¾‹
                            const tab = new bootstrap.Tab(tabEl);
                            console.log(`Tab ${index + 1} åˆå§‹åŒ–æˆåŠŸ`);
                            
                            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
                            tabEl.addEventListener('click', function(e) {
                                e.preventDefault();
                                tab.show();
                                console.log('Tabåˆ‡æ¢åˆ°:', this.getAttribute('data-bs-target'));
                            });
                            
                        } catch (error) {
                            console.error(`Tab ${index + 1} åˆå§‹åŒ–å¤±è´¥:`, error);
                        }
                    });

                    // ç›‘å¬Tabåˆ‡æ¢äº‹ä»¶
                    document.addEventListener('shown.bs.tab', function(event) {
                        const targetId = event.target.getAttribute('data-bs-target');
                        console.log('Tabåˆ‡æ¢å®Œæˆ:', targetId);
                        
                        // è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°
                        if (window.app && window.app.onTabShown) {
                            window.app.onTabShown(targetId.substring(1));
                        }
                    });
                    
                    console.log('Tabå¯¼èˆªåˆå§‹åŒ–å®Œæˆ');
                }
            }, 100);
        }
    </script>
</body>
</html>
